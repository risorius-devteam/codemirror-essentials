# Line Replace (Diff/Review) Example

This example demonstrates the `useCmeLineReplace` hook from `@sung-yeop/codemirror-essentials-react`.

## Features

- **Highlight original code ranges** with custom CSS classes
- **Insert improved code below** the original (actual text insertion)
- **Customizable styling** via className props
- **Visual diff view** with red (original) and green (improved) highlights
- **Add reviews from selection** or programmatically
- **Remove individual reviews** or clear all at once

## Running the Example

```bash
# Install dependencies (from root)
pnpm install

# Run the development server
pnpm dev

# Or from the examples/line-replace directory
cd examples/line-replace
pnpm dev
```

The example will be available at `http://localhost:3003`

## Key Concepts

### ReviewInterface

```typescript
interface ReviewInterface {
  range: RangeInterface;
  improvedText: string;
  rangeClassName?: string;      // CSS class for original code
  improvedClassName?: string;   // CSS class for improved code
  id?: string;
}

interface RangeInterface {
  from: number;      // Start position (character offset)
  to: number;        // End position (character offset)
  fromLine: number;  // Start line (1-indexed)
  toLine: number;    // End line (1-indexed)
}
```

### How It Works

1. **Original code (range)**: Gets highlighted with `rangeClassName`
2. **Improved text**: Inserted below `toLine` with actual text insertion
3. **Improved text highlight**: Applied with `improvedClassName`
4. **Line numbers**: Automatically generated by CodeMirror

### Adding Reviews

```typescript
const review: ReviewInterface = {
  range: { from: 0, to: 47, fromLine: 1, toLine: 3 },
  improvedText: `/**
 * Calculate the sum of two numbers
 */
function calculateSum(a, b) {
  return a + b;
}`,
  rangeClassName: "review-old",
  improvedClassName: "review-new",
  id: "review-1",
};

addReview(review);
```

### Using with Selection

```typescript
const { getSelection } = useCmeSelection(viewRef.current);
const { addReview } = useCmeLineReplace(viewRef.current);

const selection = getSelection();
if (selection?.hasSelection) {
  addReview({
    range: {
      from: selection.from,
      to: selection.to,
      fromLine: selection.fromLine,
      toLine: selection.toLine,
    },
    improvedText: "Your improved code here",
    rangeClassName: "review-old",
    improvedClassName: "review-new",
    id: `review-${Date.now()}`,
  });
}
```

## Styling

The example includes custom CSS for review decorations:

```css
/* Original code (to be replaced) - red background */
.review-old {
  background-color: rgba(255, 100, 100, 0.15);
  border-left: 3px solid #ff6666;
  padding-left: 4px;
}

/* Improved code (replacement) - green background */
.review-new {
  background-color: rgba(100, 255, 100, 0.15);
  border-left: 3px solid #66ff66;
  padding-left: 4px;
}
```

You can define these in your global CSS or inline styles.

## Important Notes

- **Actual text insertion**: The `improvedText` is inserted into the document, triggering `onChange`
- **Removing reviews**: Only removes highlights, not the inserted text
- **Multiple reviews**: Use `addReviews([...])` for better performance
- **Line numbers**: Automatically handled by CodeMirror after text insertion

## Use Cases

- Code review tools with AI suggestions
- Diff/merge visualizations
- Educational code feedback
- Linting and quality improvement suggestions
- Automated refactoring tools
